<!DOCTYPE html>
 
<html>
<head>
   <meta http-equiv="content-type" content="text/html; charset=utf-8" />
   <title>What is faster on Sieve of Eratosthenes: Go, C or C++?</title>
   <link href="/favicon.png" rel="icon" />
   <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-3017739-19']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

   <link rel="stylesheet" href="/css/screen.css" type="text/css" media="screen, projection" />
   <link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" />
   <link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" /> 
   <link rel="alternate" title="Programming DIY" href="/english/atom.xml" type="application/atom+xml">
</head>
<body>

<div class="site">

  <div class="menu">
    <a class="extra" href="/">&laquo; по-русски &raquo;</a>  
    <a href="/english">blog</a> |
    <a href="/english/projects/">projects</a> |
    <a href="/english/articles/">articles</a> |
    <a href="/english/about/">about</a>
  </div>

  <div id="home">
    <h1>What is faster on Sieve of Eratosthenes: Go, C or C++?</h1>
<div id="post">
  <p>Go is a very interesting language. It compiles to native-code (no VM or JIT) and it comes with automatic garbage collection and built-in concurrency support, the object-oriented model and on top of it - extremely fast compilation.</p>

<p>I love to use <a href="http://en.wikipedia.org/wiki/Sieve_of_Eratosthenes">Sieve of Eratosthenes</a> as &ldquo;Hello, world!&rdquo; when exploring a new language.</p>

<p>Here is my version of the seive in Go:</p>

<p>File <code>erato-go-bool.go</code>:</p>

<pre><code class="go">package main

import &quot;fmt&quot;
import &quot;math&quot;
import &quot;flag&quot;

func main() {
    var N int
    flag.IntVar(&amp;N, &quot;N&quot;, 100, &quot;&quot;)
    flag.Parse()

    fmt.Printf(&quot;%d\n&quot;, N)

    seive := make([]bool, N)
   
    limit := int(math.Sqrt(float64(N))) + 1

    for i := 2; i &lt; limit; i++ {
        if !seive[i] {
            for j := i * i; j &lt; N; j += i  {
                seive[j] = true
            }
        }
    }

    count := 0
    for i := 2; i &lt; N; i++ {
        if !seive[i] {
            count++
        }
    }
    fmt.Printf(&quot;%d\n&quot;, count)
}
</code></pre>

<p>But how fast is this?</p>

<p>I&rsquo;ve compared it against implementations in C++ and C.</p>

<p>The first competitor is Go using <code>bool</code> type in as a storage (see above). The second one is the also Go&rsquo;s version but with <code>int</code> as the storage type.</p>

<p>File <code>erato-go-int.go</code>:</p>

<pre><code class="go">package main

import &quot;fmt&quot;
import &quot;math&quot;
import &quot;flag&quot;

func main() {
    var N int
    flag.IntVar(&amp;N, &quot;N&quot;, 100, &quot;&quot;)
    flag.Parse()

    fmt.Printf(&quot;%d\n&quot;, N)

    seive := make([]int, N)
   
    limit := int(math.Sqrt(float64(N))) + 1

    for i := 2; i &lt; limit; i++ {
        if seive[i] == 0 {
            for j := i * i; j &lt; N; j += i  {
                seive[j] = 1
            }
        }
    }

    count := 0
    for i := 2; i &lt; N; i++ {
        if seive[i] == 0 {
            count++
        }
    }
    fmt.Printf(&quot;%d\n&quot;, count)
}
</code></pre>

<p>Then I tested in C++. A <code>TYPE</code> macro allows to compile the source with different types (<code>int</code> and <code>bool</code>):</p>

<p>File <code>erato-cxx.cpp</code>:</p>

<pre><code class="cpp">#include &lt;iostream&gt;
#include &lt;vector&gt;
#include &lt;cstdlib&gt;
#include &lt;cmath&gt;

int main(int argc, char* argv[]) {
  int n = argc &gt; 1 ? std::atoi(argv[1]) : 100;

  std::cout &lt;&lt; n &lt;&lt; std::endl;

  int sqrt_n = static_cast&lt;int&gt;(std::sqrt(static_cast&lt;double&gt;(n))) + 1;

  std::vector&lt;TYPE&gt; S(n, true);

  for (int i = 2; i &lt; sqrt_n; ++i)
    if (S[i])
      for (int j = i*i; j &lt; n; j+=i)
        S[j] = false;

  int count = 0;
  for (int i = 2; i &lt; n; ++i)
    if (S[i])
      count++;

  std::cout &lt;&lt; count &lt;&lt; std::endl;

  return 0;
}
</code></pre>

<p>And to have the full picture there is an implementation in C:</p>

<p>File: <code>erator-c-int.c</code>:</p>

<pre><code class="cpp">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;memory.h&gt;
#include &lt;math.h&gt;

int main(int argc, char* argv[]) {
  int n = argc &gt; 1 ? atoi(argv[1]) : 100;
  int* S;
  int count;
  int sz = n * sizeof(*S);
  int i, j;

  printf(&quot;%d\n&quot;, n);

  long sqrt_n = sqrt(n) + 1;

  S = malloc(sz);
  memset(S, 0, sz);

  for (i = 2; i &lt; sqrt_n; ++i)
    if (S[i] == 0)
      for (j = i*i; j &lt; n; j+=i)
        S[j] = 1;

  count = 0;
  for (i = 2; i &lt; n; ++i)
    if (S[i] == 0)
      count++;

  printf(&quot;%d\n&quot;, count);

  free(S);
  return 0;
}
</code></pre>

<p>Makefile for easy run:</p>

<p>File <code>Makefile</code>:</p>

<pre><code class="makefile">.SILENT: 

all: 
        $(MAKE) run 2&gt;&amp;1 | tee log
        $(MAKE) parse-log

run: go-bool go-int cxx-int cxx-bool c-int

N ?= 100000000

go-bool:
        echo $@
        6g erato-$@.go
        6l -o erato-$@ erato-$@.6
        time -p -f %e ./erato-$@ -N=$(N)

go-int: 
        echo $@
        6g erato-$@.go
        6l -o erato-$@ erato-$@.6
        time -p -f %e ./erato-$@ -N=$(N)

cxx-bool:
        echo $@
        g++ -o erato-$@ \
                -O3 -funroll-all-loops -fomit-frame-pointer \
                -DTYPE=bool erato-cxx.cpp 
        time -p -f %e ./erato-$@ $(N)

cxx-int:
        echo $@
        g++ -o erato-$@ \
                -O3 -funroll-all-loops -fomit-frame-pointer \
                -DTYPE=int erato-cxx.cpp 
        time -p -f %e ./erato-$@ $(N)

c-int:
        echo $@
        gcc -o erato-$@ -lm \
                -O3 -funroll-all-loops -fomit-frame-pointer erato-$@.c
        time -p -f %e ./erato-$@ $(N)

parse-log:
        printf &quot;%10s %10s %8s %5s\n&quot; &quot;Language&quot; N Count Time ; \
        (echo &quot;------------------------------------&quot;) ; \
        while read type ; do \
                read N &amp;&amp; \
                read count &amp;&amp; \
                read time &amp;&amp; \
                printf &quot;%10s %10s %8s %5s\n&quot; $$type $$N $$count $$time ; \
        done &lt; log
</code></pre>

<p>I run this on Ubuntu 64-bit. The C/C++ compiler is gcc 4.4.1. The Go compiler is the lastest from its official repository.</p>

<p>Run:</p>

<pre><code>make N=100000000
</code></pre>

<p>Output:</p>

<pre><code> Language           N    Count  Time
------------------------------------
   go-bool  100000000  5761455  3.96
    go-int  100000000  5761455  6.58
   cxx-int  100000000  5761455  6.76
  cxx-bool  100000000  5761455  2.20
     c-int  100000000  5761455  6.47
</code></pre>

<p>C++ using <code>std::vector&lt;book&gt;</code> has beaten C and Go. The second is Go&rsquo;s implementation also using <code>bool</code>. And on the third place are C, C++ with <code>std::vector&lt;int&gt;</code> and Go with <code>int</code>.</p>

</div>

<hr />


  <a href="http://meta-coding.blogspot.com/2010/03/what-is-faster-on-sieve-of-eratosthenes.html"><small>Original post</small></a>


<h1>Comments</h1>

<div id="disqus_thread"></div>

<script type="text/javascript">
  var disqus_shortname = 'meta-coding';
  var disqus_developer = 0;
  var disqus_identifier = 'http://meta-coding.blogspot.com/2010/03/what-is-faster-on-sieve-of-eratosthenes.html';
  var disqus_url = 'http://meta-coding.blogspot.com/2010/03/what-is-faster-on-sieve-of-eratosthenes.html';
  var disqus_script = 'embed.js';
  (function () {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  }());
</script>


  </div>

  <div class="footer">
    <div class="contact">
      &copy; 2012
      <a href="mailto:alexander@demin.ws">Alexander Demin</a> |
      <a href="/english/atom.xml" rel="subscribe-rss" title="Subscribe via RSS">RSS</a>
    </div>
  </div>

</div>

</body>
</html>
